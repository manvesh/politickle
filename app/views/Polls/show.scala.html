@(poll: Poll, choices: Seq[Choice], ownerUser: User, user: Option[User], userResponse: Option[Response])(implicit token: play.filters.csrf.CSRF.Token)
@import helper._

@metaTags(poll: Poll, choices: Seq[Choice], ownerName: String, ownerTwitterHandle: String, ownerTwitterId: String) = {
    <meta name="twitter:card" content="politickle">
    <meta name="twitter:politickle:asker:id" content="@ownerTwitterId">
    <meta name="twitter:politickle:asker:name" content="@ownerName">
    <meta name="twitter:politickle:question" content="@poll.description">
    <meta name="twitter:politickle:choice1:text" content="@choices.head.description">
    <meta name="twitter:politickle:choice2:text" content="@choices.last.description">
    <meta name="twitter:politickle:submiturl" content="http://cards-staging.twitter.com/cards/caps?@routes.ResponsesController.create(poll.id.get, true)">
    <meta name="twitter:politickle:cardurl" content="http://cards-staging.twitter.com/cards/caps?@routes.PollsController.show(poll.id.get)">
    <meta name="twitter:politickle:politician2:id" content="111092283">
    <meta name="twitter:politickle:politician2:name" content="@@WeWork">
}

@*
@initData = {
  <input type="hidden" class="json-data" id="init-data" value='{"pageName": "polls/show"}'/>
}
*@

@layout(title=poll.description, headContent=metaTags(poll, choices, ownerUser.twitterName, ownerUser.twitterHandle.get, ownerUser.twitterId)) {

  @if( userResponse.isDefined ) {
    <div class="alert alert-success"><span class="glyphicon glyphicon-saved"></span> You have answered this question earlier, but you can <em>reanswer</em>.</span></div>
  }
  <h2>@poll.description</h2>
  <form method="post" action="@routes.ResponsesController.create(poll.id.get, false)">
      <input name="poll_id" value="@poll.id" type="hidden" />
      <div class="form-group btn-group" data-toggle="buttons">
      @for(choice <- choices) {
        <p>
        <label class="btn btn-default">
          <input type="radio" name="choice_id" value="@choice.id" @if(userResponse.isDefined && userResponse.get.choiceId == choice.id.get) {
            checked
          }
            > @choice.description
        </label>
        </p>
      }
      </div>
      <script type="text/javascript">
        $('.btn').button();
      </script>
    @if( user.isEmpty ){
      <p>
        <a href="@securesocial.core.providers.utils.RoutesHelper.authenticate("twitter")">
          <img src="@routes.Assets.at("images/sign-in-with-twitter-gray.png")" alt="Sign in with Twitter">
        </a>
      </p>
    } else {
      <div class="form-group input-group">
        <span class="input-group-addon">Add explanation</span>
        <input name="explanation" type="text" class="form-control" placeholder="..." value="@if(userResponse.isDefined) { @userResponse.get.explanationText }">
      </div>
      @CSRF.formField
      <input name="twitter_id" type="hidden" value="@user.get.twitterId" >
      <div class="form-group">
      <input class="btn btn-primary" type="submit" value="Submit your answer">
      </div>
      </p>
    }
  </form>
  <br/>
  <h5>Poll was created by <br/> <a href="https://twitter.com/@ownerUser.twitterHandle">@@@ownerUser.twitterHandle</a></h5>
}
