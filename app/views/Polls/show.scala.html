@(poll: Poll, choices: Seq[Choice], ownerUser: User, user: Option[User], userResponse: Option[Response])(implicit token: play.filters.csrf.CSRF.Token)
@import helper._

@metaTags(poll: Poll, choices: Seq[Choice], ownerName: String, ownerTwitterHandle: String, ownerTwitterId: String) = {
    <meta name="twitter:card" content="com.politickle:politickle">
    <meta name="twitter:politickle:asker:id" content="@ownerTwitterId">
    <meta name="twitter:politickle:asker:name" content="@ownerName">
    <meta name="twitter:politickle:question" content="@poll.description">
    <meta name="twitter:politickle:choice1:text" content="@choices.head.description">
    <meta name="twitter:politickle:choice2:text" content="@choices.last.description">
    <meta name="twitter:politickle:submiturl" content="https://politickle.herokuapp.com/polls/@poll.id/responses">
    <meta name="twitter:politickle:cardurl" content="https://politickle.herokuapp.com/polls/@poll.id">
    <meta name="twitter:politickle:politician1:id" content="9651">
    <meta name="twitter:politickle:politician1:name" content="cbrumelle">
    <meta name="twitter:politickle:politician2:id" content="14877873">
    <meta name="twitter:politickle:politician2:name" content="vyas">
}

@initData = {
  <input type="hidden" class="json-data" id="init-data" value='{"pageName": "polls/show"}'/>
}

@choicesRadioButton(choice: Choice, userResponse: Option[Response]) = {
  @if(userResponse.isDefined && userResponse.get.choiceId == choice.id.get) {
  <label class="btn btn-default active">
    <input type="radio" name="choice_id" id="choice_id_@choice.id" value="@choice.id" checked > @choice.description
  </label>
  } else {
  <label class="btn btn-default">
    <input type="radio" name="choice_id" id="choice_id_@choice.id" value="@choice.id"> @choice.description
  </label>
  }
}

@layout(title=poll.description, headContent=metaTags(poll, choices, ownerUser.twitterName, ownerUser.twitterHandle.get, ownerUser.twitterId), initData=initData) {

  @if( userResponse.isDefined ) {
    <div class="alert alert-success">You have <strong>answered</strong> this question earlier, but you can <strong><em>reanswer</em></strong>.</div>
  }
  <h2 id="poll-description">@poll.description</h2>
  <form id="user-response" name="user-response" method="post" action="@routes.ResponsesController.create(poll.id.get, false)">
      <input name="poll_id" value="@poll.id" type="hidden" />
      <div class="container">
        <div id="choice-btns" class="col-md8 form-group btn-group" data-toggle="buttons">
        @for(choice <- choices) {
        <p>
          @choicesRadioButton(choice, userResponse)
        </p>
        }
        </div>
        <div id="chart" class="col-md4 pull-right"></div>
      </div>
      @if( user.isEmpty ){
      <p>
        <a href="@securesocial.core.providers.utils.RoutesHelper.authenticate("twitter")">
          <img src="@routes.Assets.at("images/sign-in-with-twitter-gray.png")" alt="Sign in with Twitter">
        </a>
      </p>
      } else {
      <div class="form-group input-group">
        <span class="input-group-addon">Add explanation</span>
        <input name="explanation" type="text" class="form-control" placeholder="..." value="@if(userResponse.isDefined) { @userResponse.get.explanationText }">
      </div>
      @CSRF.formField
      <input name="twitter_id" type="hidden" value="@user.get.twitterId" >
      <div class="form-group">
      <input class="btn btn-primary" type="submit" value="Submit your answer">
      </div>
      </p>
    }
  </form>
  <br/>
  <h5>Poll was created by <br/> <a href="https://twitter.com/@ownerUser.twitterHandle">@@@ownerUser.twitterHandle</a></h5>
}
